<!DOCTYPE html>
<html lang="pt-BR">
<head>
ย ย <meta charset="UTF-8" />
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0" />
ย ย <title>Encrypta - Desafio Diรกrio</title>
ย ย <script src="https://cdn.tailwindcss.com"></script>
ย ย <link rel="preconnect" href="https://fonts.googleapis.com">
ย ย <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
ย ย <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
ย ย <link rel="stylesheet" href="style.css">
</head>
<body>
ย ย <div id="loading-overlay" class="loading-overlay">
ย ย ย ย <div class="spinner"></div>
ย ย </div>

ย ย <main class="container" id="appContainer">

ย ย ย ย <div class="game-intro">
ย ย ย ย ย ย <h1 class="main-title">ENCRYPTA</h1>
ย ย ย ย ย ย <p>O jogo diรกrio de palavras criptografadas</p>
ย ย ย ย </div>

ย ย ย ย <section id="login-section" class="content-section is-visible">
ย ย ย ย ย ย <form>
ย ย ย ย ย ย ย ย <h2>Entrar</h2>
ย ย ย ย ย ย ย ย <input type="text" id="login-username" placeholder="Nome de Usuรกrio" required />
ย ย ย ย ย ย ย ย <input type="password" id="login-password" placeholder="Senha" required />
ย ย ย ย ย ย ย ย <button class="btn" id="btnLogin">Entrar</button>
ย ย ย ย ย ย ย ย <p>Ainda nรฃo tem conta? <a href="#" id="goRegister">Registrar</a></p>
ย ย ย ย ย ย ย ย <p><a href="#" id="goForgotPassword">Esqueceu a senha?</a></p>
ย ย ย ย ย ย ย ย <p id="loginMsg" class="result-message"></p>
ย ย ย ย ย ย </form>
ย ย ย ย </section>

ย ย ย ย <section id="register-section" class="content-section">
ย ย ย ย ย ย <form>
ย ย ย ย ย ย ย ย <h2>Registrar</h2>
ย ย ย ย ย ย ย ย <input type="email" id="register-email" placeholder="E-mail" required />
ย ย ย ย ย ย ย ย <input type="text" id="register-username" placeholder="Nome de Usuรกrio" required />
ย ย ย ย ย ย ย ย <input type="password" id="register-password" placeholder="Senha" required />
ย ย ย ย ย ย ย ย <button class="btn" id="btnRegister">Criar Conta</button>
ย ย ย ย ย ย ย ย <p>Jรก tem conta? <a href="#" id="goLogin">Login</a></p>
ย ย ย ย ย ย ย ย <p id="registerMsg" class="result-message"></p>
ย ย ย ย ย ย </form>
ย ย ย ย </section>

ย ย ย ย <section id="forgot-password-section" class="content-section">
ย ย ย ย ย ย <form>
ย ย ย ย ย ย ย ย <h2>Recuperar Senha</h2>
ย ย ย ย ย ย ย ย <p>Informe o e-mail de cadastro para receber o link de recuperaรงรฃo de senha.</p>
ย ย ย ย ย ย ย ย <input type="email" id="forgot-password-email" placeholder="E-mail" required />
ย ย ย ย ย ย ย ย <button class="btn" id="btnForgotPassword">Enviar Link</button>
ย ย ย ย ย ย ย ย <p><a href="#" id="goLoginFromForgotPassword">Voltar para o Login</a></p>
ย ย ย ย ย ย ย ย <p id="forgotPasswordMsg" class="result-message"></p>
ย ย ย ย ย ย </form>
ย ย ย ย </section>

ย ย ย ย <section id="game-section" class="content-section">
ย ย ย ย ย ย <h1 class="main-title">ENCRYPTA โ Desafio Diรกrio</h1>
ย ย ย ย ย ย <p id="welcome" class="welcome-message"></p>

ย ย ย ย ย ย <div id="alreadyPlayedMsg" class="already-played-msg">
ย ย ย ย ย ย ย ย โ๏ธ Vocรช jรก completou o desafio de hoje. Volte amanhรฃ.
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div id="instructions" class="game-instructions">
ย ย ย ย ย ย ย ย <p>
ย ย ย ย ย ย ย ย ย ย Todo dia liberamos um novo tema com <strong>3 palavras criptografadas</strong>.<br />
ย ย ย ย ย ย ย ย ย ย Vocรช precisa decifrรก-las digitando as respostas.<br />
ย ย ย ย ย ย ย ย ย ย Quanto menos tentativas e mais rรกpido concluir, <strong>maior a sua pontuaรงรฃo</strong>.
ย ย ย ย ย ย ย ย </p>
ย ย ย ย ย ย ย ย <p>
ย ย ย ย ย ย ย ย ย ย <em>Exemplo:</em> <strong>"LUA" โ "QZE"</strong>. As 3 palavras usam a mesma substituiรงรฃo de letras.
ย ย ย ย ย ย ย ย </p>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <p id="theme" class="theme-text"></p>

ย ย ย ย ย ย <div id="challenge" class="challenge-container"></div>

ย ย ย ย ย ย ย ย ย ย ย ย <button id="hintButton" class="btn" style="display: none;">Dica</button>
ย ย ย ย ย ย <div id="hintDisplay" class="hint-display" style="display: none; margin-top: 1rem; color: #10b981; font-weight: bold;"></div>

ย ย ย ย ย ย <button id="loadChallenge" class="btn">Carregar Desafio do Dia</button>
ย ย ย ย ย ย <button id="submitAnswers" class="btn" style="display: none;">Enviar Respostas</button>
ย ย ย ย ย ย <p id="result" class="result-message"></p>
ย ย ย ย ย ย <button id="logout" class="btn btn-danger" style="display:none;">Sair</button>

ย ย ย ย ย ย <div id="ranking-section" class="ranking-flex hidden">
ย ย ย ย ย ย ย ย <div class="ranking-block">
ย ย ย ย ย ย ย ย ย ย <h2>๐ Diรกrio</h2>
ย ย ย ย ย ย ย ย ย ย <table id="daily-ranking" class="ranking-table">
ย ย ย ย ย ย ย ย ย ย ย ย <thead>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <tr><th>#</th><th>Usuรกrio</th><th>Pontos</th></tr>
ย ย ย ย ย ย ย ย ย ย ย ย </thead>
ย ย ย ย ย ย ย ย ย ย ย ย <tbody></tbody>
ย ย ย ย ย ย ย ย ย ย </table>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="ranking-block">
ย ย ย ย ย ย ย ย ย ย <h2>๐ Global</h2>
ย ย ย ย ย ย ย ย ย ย <table id="global-ranking" class="ranking-table">
ย ย ย ย ย ย ย ย ย ย ย ย <thead>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <tr><th>#</th><th>Usuรกrio</th><th>Pontos</th></tr>
ย ย ย ย ย ย ย ย ย ย ย ย </thead>
ย ย ย ย ย ย ย ย ย ย </table>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </section>
ย ย </main>
ย ยย
ย ย <script type="module">
ย ย ย ย import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
ย ย ย ย import {ย
ย ย ย ย ย ย getAuth,ย
ย ย ย ย ย ย createUserWithEmailAndPassword,ย
ย ย ย ย ย ย signInWithEmailAndPassword,ย
ย ย ย ย ย ย onAuthStateChanged,ย
ย ย ย ย ย ย signOut,
ย ย ย ย ย ย sendPasswordResetEmailย
ย ย ย ย } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
ย ย ย ย import {ย
ย ย ย ย ย ย getFirestore,ย
ย ย ย ย ย ย doc,ย
ย ย ย ย ย ย setDoc,ย
ย ย ย ย ย ย getDoc,ย
ย ย ย ย ย ย collection,ย
ย ย ย ย ย ย query,ย
ย ย ย ย ย ย where,ย
ย ย ย ย ย ย getDocs,ย
ย ย ย ย ย ย orderBy,ย
ย ย ย ย ย ย limit,ย
ย ย ย ย ย ย addDocย
ย ย ย ย } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

ย ย ย ย // ==========================================================
ย ย ย ย // CONFIGURAรรO DO PROJETO FIREBASE (COM SUAS CREDENCIAIS)
ย ย ย ย // ==========================================================
ย ย ย ย const firebaseConfig = {
ย ย ย ย ย ย apiKey: "AIzaSyC8UGRrAwvAQ_PEy7STJwQWUSnE2-qWuII",
ย ย ย ย ย ย authDomain: "encryptame-1.firebaseapp.com",
ย ย ย ย ย ย projectId: "encryptame-1",
ย ย ย ย ย ย storageBucket: "encryptame-1.appspot.com",
ย ย ย ย ย ย messagingSenderId: "109950408456",
ย ย ย ย ย ย appId: "1:109950408456:web:65492d295240c5f106603a"
ย ย ย ย };
ย ย ย ยย
ย ย ย ย // Inicializa o Firebase e seus serviรงos
ย ย ย ย const app = initializeApp(firebaseConfig);
ย ย ย ย const auth = getAuth(app);
ย ย ย ย const db = getFirestore(app);

ย ย ย ย // ==========================================================
ย ย ย ย // VARIรVEIS E FUNรรES GERAIS
ย ย ย ย // ==========================================================
ย ย ย ย let originalWords = [];
ย ย ย ย let startTime = null;
ย ย ย ย let attempts = 0;
ย ย ย ย let hintUsedToday = false; // NOVO: Flag para a dica
ย ย ย ย let longestWordCipher = ''; // NOVO: Variรกvel para armazenar a palavra criptografada mais longa

ย ย ย ย const loadingOverlay = document.getElementById("loading-overlay");
ย ย ย ย function showLoading() {
ย ย ย ย ย ย loadingOverlay.classList.add("is-visible");
ย ย ย ย }
ย ย ย ย function hideLoading() {
ย ย ย ย ย ย loadingOverlay.classList.remove("is-visible");
ย ย ย ย }

ย ย ย ย // Funรงรฃo para mostrar ou esconder seรงรตes
ย ย ย ย function showSection(id) {
ย ย ย ย ย ย document.querySelectorAll('.content-section').forEach(section => {
ย ย ย ย ย ย ย ย section.classList.remove('is-visible');
ย ย ย ย ย ย });
ย ย ย ย ย ย const el = document.getElementById(id);
ย ย ย ย ย ย if (el) {
ย ย ย ย ย ย ย ย el.classList.add('is-visible');
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // Funรงรตes de UI
ย ย ย ย function showGameUI(user) {
ย ย ย ย ย ย showSection("game-section");
ย ย ย ย ย ย document.getElementById("welcome").textContent = `๐ Bem-vindo, ${user}!`;
ย ย ย ย ย ย document.getElementById("logout").style.display = "block";
ย ย ย ย ย ย clearDailyBlockUI(); // garante que o aviso nรฃo apareรงa atรฉ a checagem no ranking
ย ย ย ย ย ย loadRanking();
ย ย ย ย ย ย // NOVO: Esconder o botรฃo de dica e o display
ย ย ย ย ย ย document.getElementById("hintButton").style.display = "none";
ย ย ย ย ย ย document.getElementById("hintDisplay").style.display = "none";
ย ย ย ย ย ย document.getElementById("hintDisplay").textContent = "";
ย ย ย ย }

ย ย ย ย function showDailyBlockForUser() {
ย ย ย ย ย ย const el = document.getElementById("alreadyPlayedMsg");
ย ย ย ย ย ย if (el) {
ย ย ย ย ย ย ย ย el.style.display = "block";
ย ย ย ย ย ย }
ย ย ย ย ย ย document.getElementById("instructions").style.display = "none";
ย ย ย ย ย ย document.getElementById("loadChallenge").style.display = "none";
ย ย ย ย ย ย document.getElementById("submitAnswers").style.display = "none";
ย ย ย ย ย ย const resultMsg = document.getElementById("result");
ย ย ย ย ย ย resultMsg.textContent = "";
ย ย ย ย ย ย resultMsg.classList.remove("win");
ย ย ย ย ย ย // NOVO: Esconder o botรฃo de dica e o display
ย ย ย ย ย ย document.getElementById("hintButton").style.display = "none";
ย ย ย ย ย ย document.getElementById("hintDisplay").style.display = "none";
ย ย ย ย }

ย ย ย ย function showWinMessage() {
ย ย ย ย ย ย const el = document.getElementById("alreadyPlayedMsg");
ย ย ย ย ย ย if (el) {
ย ย ย ย ย ย ย ย el.style.display = "block";
ย ย ย ย ย ย }
ย ย ย ย ย ย const resultMsg = document.getElementById("result");
ย ย ย ย ย ย resultMsg.classList.add("win");
ย ย ย ย ย ย resultMsg.textContent = "Parabรฉns, vocรช completou o desafio de hoje. Volte amanhรฃ para solucionar mais um.";
ย ย ย ย ย ย document.getElementById("loadChallenge").style.display = "none";
ย ย ย ย ย ย document.getElementById("submitAnswers").style.display = "none";
ย ย ย ย ย ย // NOVO: Esconder o botรฃo de dica e o display
ย ย ย ย ย ย document.getElementById("hintButton").style.display = "none";
ย ย ย ย ย ย document.getElementById("hintDisplay").style.display = "none";
ย ย ย ย }

ย ย ย ย function clearDailyBlockUI() {
ย ย ย ย ย ย const el = document.getElementById("alreadyPlayedMsg");
ย ย ย ย ย ย if (el) {
ย ย ย ย ย ย ย ย el.style.display = "none";
ย ย ย ย ย ย }
ย ย ย ย ย ย const resultMsg = document.getElementById("result");
ย ย ย ย ย ย resultMsg.classList.remove("daily-block");
ย ย ย ย ย ย resultMsg.classList.remove("win");
ย ย ย ย ย ย resultMsg.textContent = "";
ย ย ย ย ย ย resultMsg.style.color = "";
ย ย ย ย }
ย ย ย ยย
ย ย ย ย // ==========================================================
ย ย ย ย // LรGICA DE AUTENTICAรรO E FIRESTORE
ย ย ย ย // ==========================================================

ย ย ย ย // Listener global para o estado de autenticaรงรฃo
ย ย ย ย onAuthStateChanged(auth, async (user) => {
ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย if (user) {
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const docRef = doc(db, "users", user.uid);
ย ย ย ย ย ย ย ย ย ย const docSnap = await getDoc(docRef);
ย ย ย ย ย ย ย ย ย ย let username = 'Usuรกrio'; // Valor padrรฃo

ย ย ย ย ย ย ย ย ย ย if (docSnap.exists() && docSnap.data().username) {
ย ย ย ย ย ย ย ย ย ย ย ย username = docSnap.data().username;
ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย ย ย showGameUI(username);
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // --- CORREรรO: checar na coleรงรฃo 'ranking' se jรก existe registro para hoje ---
ย ย ย ย ย ย ย ย ย ย const today = new Date().toISOString().split('T')[0];
ย ย ย ย ย ย ย ย ย ย const playedQuery = query(
ย ย ย ย ย ย ย ย ย ย ย ย collection(db, "ranking"),
ย ย ย ย ย ย ย ย ย ย ย ย where("userId", "==", user.uid),
ย ย ย ย ย ย ย ย ย ย ย ย where("challengeDate", "==", today)
ย ย ย ย ย ย ย ย ย ย );
ย ย ย ย ย ย ย ย ย ย const playedSnap = await getDocs(playedQuery);

ย ย ย ย ย ย ย ย ย ย if (!playedSnap.empty) {
ย ย ย ย ย ย ย ย ย ย ย ย showDailyBlockForUser();
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById("loadChallenge").style.display = "block";
ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.error("Erro ao carregar dados do usuรกrio:", error);
ย ย ย ย ย ย ย ย ย ย const errorMessageDiv = document.createElement('div');
ย ย ย ย ย ย ย ย ย ย errorMessageDiv.textContent = 'Ocorreu um erro ao carregar seus dados.';
ย ย ย ย ย ย ย ย ย ย errorMessageDiv.style.color = 'red';
ย ย ย ย ย ย ย ย ย ย document.getElementById('appContainer').appendChild(errorMessageDiv);
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย showSection("login-section");
ย ย ย ย ย ย }
ย ย ย ย });

ย ย ย ย // Lรณgica para alternar entre as telas de login e registro
ย ย ย ย document.getElementById("goRegister").addEventListener("click", (e) => {
ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ย showSection("register-section");
ย ย ย ย });

ย ย ย ย document.getElementById("goLogin").addEventListener("click", (e) => {
ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ย showSection("login-section");
ย ย ย ย });

ย ย ย ย // Lรณgica para alternar para a tela de recuperar senha
ย ย ย ย document.getElementById("goForgotPassword").addEventListener("click", (e) => {
ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ย showSection("forgot-password-section");
ย ย ย ย });

ย ย ย ย document.getElementById("goLoginFromForgotPassword").addEventListener("click", (e) => {
ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ย showSection("login-section");
ย ย ย ย });

ย ย ย ย // Lรณgica do botรฃo de registro
ย ย ย ย document.getElementById("btnRegister").addEventListener("click", async (e) => {
ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ย const email = document.getElementById("register-email").value.trim();
ย ย ย ย ย ย const username = document.getElementById("register-username").value.trim();
ย ย ย ย ย ย const password = document.getElementById("register-password").value;
ย ย ย ย ย ย const registerMsg = document.getElementById("registerMsg");
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!email || !username || !password) {
ย ย ย ย ย ย ย ย registerMsg.textContent = "E-mail, nome de usuรกrio e senha sรฃo obrigatรณrios.";
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย showLoading();
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // Checar se o username jรก existe
ย ย ย ย ย ย ย ย const usernameQuery = query(collection(db, "users"), where("username", "==", username));
ย ย ย ย ย ย ย ย const usernameSnap = await getDocs(usernameQuery);
ย ย ย ย ย ย ย ย if (!usernameSnap.empty) {
ย ย ย ย ย ย ย ย ย ย registerMsg.textContent = "Nome de usuรกrio jรก existe. Escolha outro.";
ย ย ย ย ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย const userCredential = await createUserWithEmailAndPassword(auth, email, password);
ย ย ย ย ย ย ย ย const user = userCredential.user;

ย ย ย ย ย ย ย ย await setDoc(doc(db, "users", user.uid), {
ย ย ย ย ย ย ย ย ย ย username: username,
ย ย ย ย ย ย ย ย ย ย email: user.email,
ย ย ย ย ย ย ย ย ย ย createdAt: new Date(),
ย ย ย ย ย ย ย ย ย ย totalPoints: 0
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย registerMsg.textContent = "Registro e login realizados com sucesso!";

ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error("Erro de registro:", error);
ย ย ย ย ย ย ย ย let errorMessage = "Erro ao registrar. Tente novamente.";
ย ย ย ย ย ย ย ย if (error.code === 'auth/email-already-in-use') {
ย ย ย ย ย ย ย ย ย ย errorMessage = 'Este e-mail jรก estรก em uso.';
ย ย ย ย ย ย ย ย } else if (error.code === 'auth/weak-password') {
ย ย ย ย ย ย ย ย ย ย errorMessage = 'A senha deve ter pelo menos 6 caracteres.';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย registerMsg.textContent = errorMessage;
ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย }
ย ย ย ย });

ย ย ย ย // Lรณgica do botรฃo de login
ย ย ย ย document.getElementById("btnLogin").addEventListener("click", async (e) => {
ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ย const username = document.getElementById("login-username").value.trim();
ย ย ย ย ย ย const password = document.getElementById("login-password").value;
ย ย ย ย ย ย const loginMsg = document.getElementById("loginMsg");
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!username || !password) {
ย ย ย ย ย ย ย ย loginMsg.textContent = "Nome de usuรกrio e senha obrigatรณrios.";
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย showLoading();
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // Encontrar o e-mail do usuรกrio pelo username no Firestore
ย ย ย ย ย ย ย ย const userQuery = query(collection(db, "users"), where("username", "==", username));
ย ย ย ย ย ย ย ย const userSnapshot = await getDocs(userQuery);

ย ย ย ย ย ย ย ย if (userSnapshot.empty) {
ย ย ย ย ย ย ย ย ย ย loginMsg.textContent = "Nome de usuรกrio ou senha invรกlidos.";
ย ย ย ย ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย const userData = userSnapshot.docs[0].data();
ย ย ย ย ย ย ย ย const email = userData.email;

ย ย ย ย ย ย ย ย // Fazer o login com o e-mail e a senha no Firebase Auth
ย ย ย ย ย ย ย ย await signInWithEmailAndPassword(auth, email, password);
ย ย ย ย ย ย ย ย loginMsg.textContent = "Login realizado com sucesso!";

ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error("Erro de login:", error);
ย ย ย ย ย ย ย ย let errorMessage = "Nome de usuรกrio ou senha invรกlidos.";
ย ย ย ย ย ย ย ย if (error.code === 'auth/wrong-password') {
ย ย ย ย ย ย ย ย ย ย errorMessage = 'Senha incorreta.';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย loginMsg.textContent = errorMessage;
ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย }
ย ย ย ย });

ย ย ย ย // Lรณgica do botรฃo de recuperaรงรฃo de senha
ย ย ย ย document.getElementById("btnForgotPassword").addEventListener("click", async (e) => {
ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ย const email = document.getElementById("forgot-password-email").value.trim();
ย ย ย ย ย ย const forgotPasswordMsg = document.getElementById("forgotPasswordMsg");

ย ย ย ย ย ย if (!email) {
ย ย ย ย ย ย ย ย forgotPasswordMsg.textContent = "Por favor, digite seu e-mail.";
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย showLoading();
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย await sendPasswordResetEmail(auth, email);
ย ย ย ย ย ย ย ย forgotPasswordMsg.textContent = "Um link de recuperaรงรฃo de senha foi enviado para seu e-mail!";
ย ย ย ย ย ย ย ย forgotPasswordMsg.style.color = "#10b981";
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error("Erro ao enviar link de recuperaรงรฃo:", error);
ย ย ย ย ย ย ย ย let errorMessage = "Erro ao enviar o link. Verifique o e-mail e tente novamente.";
ย ย ย ย ย ย ย ย if (error.code === 'auth/user-not-found') {
ย ย ย ย ย ย ย ย ย ย errorMessage = 'Nenhuma conta encontrada com este e-mail.';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย forgotPasswordMsg.textContent = errorMessage;
ย ย ย ย ย ย ย ย forgotPasswordMsg.style.color = "red";
ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย }
ย ย ย ย });

ย ย ย ย // Lรณgica do botรฃo de logout
ย ย ย ย document.getElementById("logout").addEventListener("click", async () => {
ย ย ย ย ย ย showLoading();
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย await signOut(auth);
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error("Erro ao sair:", error);
ย ย ย ย ย ย ย ย const errorMessageDiv = document.createElement('div');
ย ย ย ย ย ย ย ย errorMessageDiv.textContent = 'Erro ao tentar sair.';
ย ย ย ย ย ย ย ย errorMessageDiv.style.color = 'red';
ย ย ย ย ย ย ย ย document.getElementById('appContainer').appendChild(errorMessageDiv);
ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย }
ย ย ย ย });
ย ย ย ยย
ย ย ย ย // ==========================================================
ย ย ย ย // LรGICA DO JOGO E RANKING
ย ย ย ย // ==========================================================
ย ย ย ยย
ย ย ย ย // Funรงรตes utilitรกrias
ย ย ย ย function normalizeString(str) {
ย ย ย ย ย ย if (!str) return "";
ย ย ย ย ย ย return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
ย ย ย ย }

ย ย ย ย function encryptWord(word, cipher) {
ย ย ย ย ย ย if (!word || !cipher) return "";
ย ย ย ย ย ย const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
ย ย ย ย ย ย let encrypted = "";
ย ย ย ย ย ย const normalizedWord = normalizeString(word).toUpperCase();
ย ย ย ย ย ย for (let i = 0; i < normalizedWord.length; i++) {
ย ย ย ย ย ย ย ย const char = normalizedWord[i];
ย ย ย ย ย ย ย ย if (char >= 'A' && char <= 'Z') {
ย ย ย ย ย ย ย ย ย ย const index = alphabet.indexOf(char);
ย ย ย ย ย ย ย ย ย ย if (index !== -1) {
ย ย ย ย ย ย ย ย ย ย ย ย encrypted += cipher[index];
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย encrypted += char;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย encrypted += char;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย ย ย return encrypted;
ย ย ย ย }

ย ย ย ย // Funรงรฃo para calcular a pontuaรงรฃo
ย ย ย ย function calculatePoints(answerTime, attempts) {
ย ย ย ย ย ย const basePoints = 1000;
ย ย ย ย ย ย const timePenalty = answerTime * 5;
ย ย ย ย ย ย const attemptsPenalty = (attempts - 1) * 50;
ย ย ย ย ย ย let points = basePoints - timePenalty - attemptsPenalty;
ย ย ย ย ย ย return Math.max(100, points); // Garante que a pontuaรงรฃo mรญnima seja 100
ย ย ย ย }

ย ย ย ย // NOVO: Funรงรฃo para gerar e exibir a dica
ย ย ย ย function generateAndShowHint(originalWord, encryptedWord, cipher) {
ย ย ย ย ย ย const hintDisplay = document.getElementById("hintDisplay");
ย ย ย ย ย ย const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
ย ย ย ย ย ย const normalizedWord = normalizeString(originalWord).toUpperCase();
ย ย ย ย ย ยย
ย ย ย ย ย ย if (normalizedWord.length < 2) {
ย ย ย ย ย ย ย ย hintDisplay.textContent = "A dica nรฃo estรก disponรญvel para esta palavra.";
ย ย ย ย ย ย ย ย hintDisplay.style.display = "block";
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย // Escolher 2 รญndices aleatรณrios รบnicos
ย ย ย ย ย ย const indices = new Set();
ย ย ย ย ย ย while (indices.size < 2) {
ย ย ย ย ย ย ย ย indices.add(Math.floor(Math.random() * normalizedWord.length));
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย const hintParts = [];
ย ย ย ย ย ย let hintText = "";
ย ย ย ย ย ยย
ย ย ย ย ย ย // Preencher os inputs e montar a dica
ย ย ย ย ย ย indices.forEach(index => {
ย ย ย ย ย ย ย ย const originalChar = normalizedWord[index];
ย ย ย ย ย ย ย ย const encryptedChar = encryptedWord[index];
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const input = document.querySelector(`[data-word-index="2"][data-letter-index="${index}"]`);
ย ย ย ย ย ย ย ย if (input) {
ย ย ย ย ย ย ย ย ย ย input.value = originalChar;
ย ย ย ย ย ย ย ย ย ย input.readOnly = true;
ย ย ย ย ย ย ย ย ย ย input.classList.add('bg-gray-200'); // Estilo para indicar que estรก preenchido
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย hintParts.push(`${encryptedChar} โ ${originalChar}`);
ย ย ย ย ย ย });
ย ย ย ย ย ยย
ย ย ย ย ย ย hintText = hintParts.join(' ; ');
ย ย ย ย ย ย hintDisplay.textContent = hintText;
ย ย ย ย ย ย hintDisplay.style.display = "block";
ย ย ย ย ย ย document.getElementById("hintButton").style.display = "none";
ย ย ย ย ย ย hintUsedToday = true;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย // Carregar Desafio
ย ย ย ย document.getElementById("loadChallenge").addEventListener("click", async () => {
ย ย ย ย ย ย const user = auth.currentUser;
ย ย ย ย ย ย if (!user) return;
ย ย ย ยย
ย ย ย ย ย ย showLoading();
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // Seguranรงa extra: checar novamente se jรก jogou hoje
ย ย ย ย ย ย ย ย const today = new Date().toISOString().split('T')[0];
ย ย ย ย ย ย ย ย const playedQuery = query(
ย ย ย ย ย ย ย ย ย ย collection(db, "ranking"),
ย ย ย ย ย ย ย ย ย ย where("userId", "==", user.uid),
ย ย ย ย ย ย ย ย ย ย where("challengeDate", "==", today)
ย ย ย ย ย ย ย ย );
ย ย ย ย ย ย ย ย const playedSnap = await getDocs(playedQuery);
ย ย ย ย ย ย ย ย if (!playedSnap.empty) {
ย ย ย ย ย ย ย ย ย ย showDailyBlockForUser();
ย ย ย ย ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย const challengeRef = doc(db, "desafios", today);
ย ย ย ย ย ย ย ย const challengeSnap = await getDoc(challengeRef);
ย ย ย ยย
ย ย ย ย ย ย ย ย if (challengeSnap.exists()) {
ย ย ย ย ย ย ย ย ย ย const challengeData = challengeSnap.data();
ย ย ย ย ย ย ย ย ย ย const words = [
ย ย ย ย ย ย ย ย ย ย ย ย challengeData.short_word,
ย ย ย ย ย ย ย ย ย ย ย ย challengeData.medium_word,
ย ย ย ย ย ย ย ย ย ย ย ย challengeData.long_word
ย ย ย ย ย ย ย ย ย ย ];
ย ย ย ย ย ย ย ย ย ย const cipher = challengeData.cipher_alpha;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const cipheredWords = words.map(word => encryptWord(word, cipher));
ย ย ย ย ย ย ย ย ย ย originalWords = words;
ย ย ย ย ย ย ย ย ย ย longestWordCipher = cipheredWords[2]; // NOVO: Armazena a palavra criptografada mais longa
ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย document.getElementById("theme").textContent = `Tema: ${challengeData.theme || "Sem tema"}`;
ย ย ย ย ย ย ย ย ย ย const challengeDiv = document.getElementById("challenge");
ย ย ย ย ย ย ย ย ย ย challengeDiv.innerHTML = "";
ย ย ย ย ย ย ย ย ย ย cipheredWords.forEach((word, wordIndex) => {
ย ย ย ย ย ย ย ย ย ย ย ย const wordDiv = document.createElement("div");
ย ย ย ย ย ย ย ย ย ย ย ย wordDiv.className = "challenge-word";
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย const encryptedDisplay = word.split('').join(' ');
ย ย ย ย ย ย ย ย ย ย ย ย wordDiv.innerHTML = `<p class="encrypted-text">${encryptedDisplay}</p>`;
ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย const inputContainer = document.createElement("div");
ย ย ย ย ย ย ย ย ย ย ย ย inputContainer.className = "input-container";
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย for (let i = 0; i < word.length; i++) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const input = document.createElement("input");
ย ย ย ย ย ย ย ย ย ย ย ย ย ย input.type = "text";
ย ย ย ย ย ย ย ย ย ย ย ย ย ย input.maxLength = "1";
ย ย ย ย ย ย ย ย ย ย ย ย ย ย input.className = "letter-input w-8 h-8";
ย ย ย ย ย ย ย ย ย ย ย ย ย ย input.setAttribute("data-word-index", wordIndex);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย input.setAttribute("data-letter-index", i);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย input.addEventListener("input", (e) => {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (e.target.value) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย const nextInput = document.querySelector(`[data-word-index="${wordIndex}"][data-letter-index="${i + 1}"]`);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (nextInput) nextInput.focus();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย ย ย ย ย input.addEventListener("keydown", (e) => {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (e.key === "Backspace" && !e.target.value) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย const prevInput = document.querySelector(`[data-word-index="${wordIndex}"][data-letter-index="${i - 1}"]`);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (prevInput) prevInput.focus();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย ย ย ย ย inputContainer.appendChild(input);
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย wordDiv.appendChild(inputContainer);
ย ย ย ย ย ย ย ย ย ย ย ย challengeDiv.appendChild(wordDiv);
ย ย ย ย ย ย ย ย ย ย });
ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย document.getElementById("instructions").style.display = "none";
ย ย ย ย ย ย ย ย ย ย document.getElementById("loadChallenge").style.display = "none";
ย ย ย ย ย ย ย ย ย ย document.getElementById("submitAnswers").style.display = "block";
ย ย ย ย ย ย ย ย ย ย clearDailyBlockUI();
ย ย ย ย ย ย ย ย ย ย document.getElementById("result").textContent = "";
ย ย ย ย ย ย ย ย ย ย startTime = Date.now();
ย ย ย ย ย ย ย ย ย ย attempts = 0;
ย ย ย ย ย ย ย ย ย ย hintUsedToday = false; // NOVO: Reinicia a flag da dica
ย ย ย ย ย ย ย ย ย ย // NOVO: Mostra o botรฃo de dica apenas se a palavra mais longa tiver pelo menos 2 letras
ย ย ย ย ย ย ย ย ย ย if (originalWords[2] && originalWords[2].length >= 2) {
ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById("hintButton").style.display = "block";
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย document.getElementById("hintDisplay").style.display = "none"; // Garante que a dica nรฃo esteja visรญvel
ย ย ย ยย
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย document.getElementById("theme").textContent = "Nenhum desafio encontrado para hoje.";
ย ย ย ย ย ย ย ย ย ย document.getElementById("loadChallenge").style.display = "none";
ย ย ย ย ย ย ย ย ย ย document.getElementById("hintButton").style.display = "none";
ย ย ย ย ย ย ย ย }
ย ย ย ยย
ย ย ย ย ย ย } catch (err) {
ย ย ย ย ย ย ย ย console.error("Erro ao carregar desafio:", err);
ย ย ย ย ย ย ย ย const errorMessageDiv = document.createElement('div');
ย ย ย ย ย ย ย ย errorMessageDiv.textContent = 'Erro ao carregar desafio do dia.';
ย ย ย ย ย ย ย ย errorMessageDiv.style.color = 'red';
ย ย ย ย ย ย ย ย document.getElementById('appContainer').appendChild(errorMessageDiv);
ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย }
ย ย ย ย });
ย ย ย ยย
ย ย ย ย // NOVO: Event listener para o botรฃo de dica
ย ย ย ย document.getElementById("hintButton").addEventListener("click", () => {
ย ย ย ย ย ย if (!hintUsedToday && originalWords[2]) {
ย ย ย ย ย ย ย ย const longestWord = originalWords[2];
ย ย ย ย ย ย ย ย generateAndShowHint(longestWord, longestWordCipher);
ย ย ย ย ย ย }
ย ย ย ย });

ย ย ย ย // Verificar Respostas + Enviar Ranking
ย ย ย ย document.getElementById("submitAnswers").addEventListener("click", async () => {
ย ย ย ย ย ย const user = auth.currentUser;
ย ย ย ย ย ย if (!user) return;

ย ย ย ย ย ย showLoading();
ย ย ย ย ย ยย
ย ย ย ย ย ย attempts++;
ย ย ย ย ย ยย
ย ย ย ย ย ย let correctCount = 0;
ย ย ย ย ย ย originalWords.forEach((answer, wordIndex) => {
ย ย ย ย ย ย ย ย const inputs = document.querySelectorAll(`[data-word-index="${wordIndex}"]`);
ย ย ย ย ย ย ย ย let guessedWord = "";
ย ย ย ย ย ย ย ย inputs.forEach(input => guessedWord += input.value);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const normalizedGuessedWord = normalizeString(guessedWord).toUpperCase();
ย ย ย ย ย ย ย ย const normalizedAnswer = normalizeString(String(answer || "")).toUpperCase();
ย ย ย ย ย ย ย ย const isWordCorrect = normalizedGuessedWord === normalizedAnswer;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (isWordCorrect) {
ย ย ย ย ย ย ย ย ย ย correctCount++;
ย ย ย ย ย ย ย ย }
ย ย ย ยย
ย ย ย ย ย ย ย ย inputs.forEach(input => {
ย ย ย ย ย ย ย ย ย ย input.classList.remove('bg-green-200', 'bg-red-200');
ย ย ย ย ย ย ย ย ย ย if (isWordCorrect) {
ย ย ย ย ย ย ย ย ย ย ย ย input.classList.add('bg-green-200');
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย input.classList.add('bg-red-200');
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย });
ย ย ย ย ย ยย
ย ย ย ย ย ย const resultMsg = document.getElementById("result");
ย ย ย ย ย ย const isCorrect = (correctCount === originalWords.length);
ย ย ย ย ย ยย
ย ย ย ย ย ย if (isCorrect) {
ย ย ย ย ย ย ย ย resultMsg.textContent = "๐ Parabรฉns! Vocรช acertou todas!";
ย ย ย ย ย ย ย ย resultMsg.style.color = "#10b981";
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const answerTime = Math.floor((Date.now() - startTime) / 1000);
ย ย ย ย ย ย ย ย const points = calculatePoints(answerTime, attempts);

ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย // CORREรรO: garantir 1 registro por usuรกrio por dia na coleรงรฃo 'ranking'
ย ย ย ย ย ย ย ย ย ย const today = new Date().toISOString().split('T')[0];
ย ย ย ย ย ย ย ย ย ย const alreadyQuery = query(
ย ย ย ย ย ย ย ย ย ย ย ย collection(db, "ranking"),
ย ย ย ย ย ย ย ย ย ย ย ย where("userId", "==", user.uid),
ย ย ย ย ย ย ย ย ย ย ย ย where("challengeDate", "==", today)
ย ย ย ย ย ย ย ย ย ย );
ย ย ย ย ย ย ย ย ย ย const alreadySnap = await getDocs(alreadyQuery);

ย ย ย ย ย ย ย ย ย ย const userDocRef = doc(db, "users", user.uid);
ย ย ย ย ย ย ย ย ย ย const userSnap = await getDoc(userDocRef);
ย ย ย ย ย ย ย ย ย ย let username = 'Usuรกrio';
ย ย ย ย ย ย ย ย ย ย let totalPoints = 0;
ย ย ย ย ย ย ย ย ย ย if (userSnap.exists()) {
ย ย ย ย ย ย ย ย ย ย ย ย username = userSnap.data().username || username;
ย ย ย ย ย ย ย ย ย ย ย ย totalPoints = userSnap.data().totalPoints || 0;
ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย ย ย if (alreadySnap.empty) {
ย ย ย ย ย ย ย ย ย ย ย ย await addDoc(collection(db, "ranking"), {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย userId: user.uid,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย username: username,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย answerTime: answerTime,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย challengeDate: today,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย attempts: attempts,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย points: points,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย timestamp: new Date()
ย ย ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย ย ย await setDoc(
ย ย ย ย ย ย ย ย ย ย ย ย ย ย userDocRef,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย { totalPoints: totalPoints + points, lastPlayed: today },
ย ย ย ย ย ย ย ย ย ย ย ย ย ย { merge: true }
ย ย ย ย ย ย ย ย ย ย ย ย );
ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย ย ย showWinMessage();
ย ย ย ย ย ย ย ย ย ย loadRanking();
ย ย ย ยย
ย ย ย ย ย ย ย ย } catch (err) {
ย ย ย ย ย ย ย ย ย ย console.error("Erro ao salvar resultado no Firestore:", err);
ย ย ย ย ย ย ย ย ย ย resultMsg.textContent = "Erro ao salvar seu resultado. Tente novamente.";
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย resultMsg.textContent = `Vocรช acertou ${correctCount} de ${originalWords.length}. Tente novamente.`;
ย ย ย ย ย ย ย ย resultMsg.style.color = "#FFB300";
ย ย ย ย ย ย ย ย // NOVO: Se o usuรกrio errou, permite a dica de novo
ย ย ย ย ย ย ย ย if (!hintUsedToday && originalWords[2] && originalWords[2].length >= 2) {
ย ย ย ย ย ย ย ย ย ย document.getElementById("hintButton").style.display = "block";
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย hideLoading();
ย ย ย ย });
ย ย ย ยย
ย ย ย ย // Carregar Ranking
ย ย ย ย async function loadRanking() {
ย ย ย ย ย ย showLoading();
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // Ranking Diรกrio
ย ย ย ย ย ย ย ย const today = new Date().toISOString().split('T')[0];
ย ย ย ย ย ย ย ย const dailyGamesQuery = query(collection(db, "ranking"), where("challengeDate", "==", today), orderBy("points", "desc"));
ย ย ย ย ย ย ย ย const dailySnapshot = await getDocs(dailyGamesQuery);
ย ย ย ย ย ย ย ย const dailyData = dailySnapshot.docs.map(doc => doc.data());
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const dailyBody = document.querySelector("#daily-ranking tbody");
ย ย ย ย ย ย ย ย dailyBody.innerHTML = "";
ย ย ย ย ย ย ย ย dailyData.forEach((row, idx) => {
ย ย ย ย ย ย ย ย ย ย dailyBody.innerHTML += `<tr>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${idx + 1}</td><td>${row.username}</td><td>${row.points}</td>
ย ย ย ย ย ย ย ย ย ย </tr>`;
ย ย ย ย ย ย ย ย });
ย ย ย ยย
ย ย ย ย ย ย ย ย // Ranking Global
ย ย ย ย ย ย ย ย const overallUsersQuery = query(collection(db, "users"), orderBy("totalPoints", "desc"), limit(10));
ย ย ย ย ย ย ย ย const overallSnapshot = await getDocs(overallUsersQuery);
ย ย ย ย ย ย ย ย const overallData = overallSnapshot.docs.map(doc => doc.data());
ย ย ย ยย
ย ย ย ย ย ย ย ย const globalBody = document.querySelector("#global-ranking tbody");
ย ย ย ย ย ย ย ย globalBody.innerHTML = "";
ย ย ย ย ย ย ย ย overallData.forEach((row, idx) => {
ย ย ย ย ย ย ย ย ย ย globalBody.innerHTML += `<tr>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${idx + 1}</td><td>${row.username}</td><td>${row.totalPoints}</td>
ย ย ย ย ย ย ย ย ย ย </tr>`;
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย document.getElementById("ranking-section").classList.remove("hidden");
ย ย ย ยย
ย ย ย ย ย ย } catch (err) {
ย ย ย ย ย ย ย ย console.error("Erro ao carregar ranking:", err);
ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย }
ย ย ย ย }
ย ย </script>
</body>
</html>
